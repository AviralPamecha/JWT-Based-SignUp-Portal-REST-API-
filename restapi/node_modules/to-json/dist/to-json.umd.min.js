!function(t,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():t.toJson=n()}(this,function(){var t,n,o,e,r,a,s={}.hasOwnProperty,i=function(t,n){function o(){this.constructor=t}for(var e in n)s.call(n,e)&&(t[e]=n[e]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},u=[].slice;return t=function(){function t(n,o){return this.data=n,this instanceof t?void(null!=o&&(this.dataKey=o.dataKey,this.jsonKey=o.jsonKey,this.parentContext=o.parentContext)):new t(this.data,o).apply()}return t.prototype.childContextClass=t,t.prototype.apply=function(t){return this._exclude()?void 0:(this._convertData(),this._excludeData()?void 0:(this._toJson(t),this._excludeJson()?void 0:this.json))},t.prototype._toJson=function(t){var n,o;this.json=t||null==(null!=(n=this.data)?n.toJson:void 0)||"function"!=typeof this.data.toJson?t||null==(null!=(o=this.data)?o.toJSON:void 0)||"function"!=typeof this.data.toJSON?this._getEnumerator()(this._toJsonNamed.bind(this)):this.data.toJSON():this.data.toJson(this)},t.prototype._getEnumeratorArray=function(){return function(t){return function(n){var o,e,r,a,s;for(t.json=[],s=t.data,r=e=0,a=s.length;a>e;r=++e)o=s[r],n(o,r,t._getJsonIndex(r));return t.json}}(this)},t.prototype._getEnumeratorObject=function(){return function(t){return function(n){var o,e,r;t.json={},e=t.data;for(o in e)s.call(e,o)&&(r=e[o],n(r,o,t._getJsonKey(o)));return t.json}}(this)},t.prototype._getEnumeratorValue=function(){return function(t){return function(){return t.json=t.data,t.json}}(this)},t.prototype._getEnumerator=function(){return Array.isArray(this.data)?this._getEnumeratorArray():"object"==typeof this.data&&null!==this.data?this._getEnumeratorObject():this._getEnumeratorValue()},t.prototype._toJsonNamed=function(t,n,o){var e,r;return e=this._createChildContext(t,n,o),r=e.apply(),void 0!==r&&(this.json[o]=r),e},t.prototype._createChildContext=function(t,n,o){return new this.childContextClass(t,{dataKey:n,jsonKey:o,parentContext:this})},t.prototype.adjustContext=function(t,n){var o,e;for(o in t)s.call(t,o)&&(e=t[o],this[o]=e);return n&&this.adjustChildContexts(t,n),this},t.prototype.adjustChildContexts=function(t,n){var o,e;this.childContextClass=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n}(this.childContextClass);for(o in t)s.call(t,o)&&(e=t[o],this.childContextClass.prototype[o]=e);return n&&(this.childContextClass.prototype.childContextClass=this.childContextClass),this},t.prototype._super=function(t){var n,o;for(o=this[t],n=this.constructor;null!=n&&n.prototype[t]===o;)n=n.__super__.constructor;return n.prototype[t]},t.prototype._callSuper=function(){var t,n;return n=arguments[0],t=2<=arguments.length?u.call(arguments,1):[],this._super(n).apply(this,t)},t.prototype._getJsonKey=function(t){return t},t.prototype._getJsonIndex=function(t){return this.json.length},t.prototype._exclude=function(){return!1},t.prototype._convertData=function(){},t.prototype._excludeData=function(){return!1},t.prototype._excludeJson=function(){return!1},t.prototype.dataPath=function(){var t,n;for(n=[],t=this;null!=t;)null!=t.dataKey&&n.unshift(t.dataKey),t=t.parentContext;return n},t.prototype.jsonPath=function(){var t,n;for(n=[],t=this;null!=t;)null!=t.jsonKey&&n.unshift(t.jsonKey),t=t.parentContext;return n},t}(),e=function(t){function n(t,o){var e,r;n.__super__.constructor.call(this,t,o),this.pathMap=null!=(e=null!=(r=this.parentContext)?r.pathMap:void 0)?e:{}}return i(n,t),n.prototype.childContextClass=n,n.prototype._toJsonNamed=function(t,o,e){var r;return r=n.__super__._toJsonNamed.call(this,t,o,e),void 0!==this.json[e]&&(this.pathMap[r.jsonPath().join("/")]=r.dataPath().join("/")),r},n}(t),t.WithPathMap=e,a=function(t){var n;for(n in t)if(s.call(t,n))return!1;return!0},r=function(t){function n(t,o){n.__super__.constructor.call(this,t,o),this.pathTree={}}return i(n,t),n.prototype.childContextClass=n,n.prototype._toJsonNamed=function(t,o,e){var r;r=n.__super__._toJsonNamed.call(this,t,o,e),void 0!==this.json[e]&&(this.pathTree[r.jsonKey]=a(r.pathTree)?{id:r.dataKey}:{id:r.dataKey,children:r.pathTree})},n}(t),t.WithPathTree=r,n=function(t){function n(t,o){var e,r;n.__super__.constructor.call(this,t,o),this.dataMap=null!=(e=null!=(r=this.parentContext)?r.dataMap:void 0)?e:{}}return i(n,t),n.prototype.childContextClass=n,n.prototype._toJsonNamed=function(t,o,e){var r;return r=n.__super__._toJsonNamed.call(this,t,o,e),void 0!==this.json[e]&&(this.dataMap[r.jsonPath().join("/")]={dataPath:r.dataPath().join("/"),data:t,convertedData:r.data,json:this.json[e]}),r},n}(t),t.WithDataMap=n,o=function(t){function n(t,o){n.__super__.constructor.call(this,t,o),this.dataTree={}}return i(n,t),n.prototype.childContextClass=n,n.prototype._toJsonNamed=function(t,o,e){var r;return r=n.__super__._toJsonNamed.call(this,t,o,e),void 0!==this.json[e]&&(this.dataTree[r.jsonKey]={id:r.dataKey,data:t,convertedData:r.data,json:this.json[e]},a(r.dataTree)||(this.dataTree[r.jsonKey].children=r.dataTree)),r},n}(t),t.WithDataTree=o,t});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRvLWpzb24uY29mZmVlIiwidG8tanNvbi51bWQuanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJleHBvcnRzIiwibW9kdWxlIiwidG9Kc29uIiwidGhpcyIsIlRvSnNvbiIsIlRvSnNvbldpdGhEYXRhTWFwIiwiVG9Kc29uV2l0aERhdGFUcmVlIiwiVG9Kc29uV2l0aFBhdGhNYXAiLCJUb0pzb25XaXRoUGF0aFRyZWUiLCJpc0VtcHR5IiwiaGFzUHJvcCIsImhhc093blByb3BlcnR5IiwiZXh0ZW5kIiwiY2hpbGQiLCJwYXJlbnQiLCJjdG9yIiwiY29uc3RydWN0b3IiLCJrZXkiLCJjYWxsIiwicHJvdG90eXBlIiwiX19zdXBlcl9fIiwic2xpY2UiLCJkYXRhMSIsIm9wdGlvbnMiLCJkYXRhIiwiZGF0YUtleSIsImpzb25LZXkiLCJwYXJlbnRDb250ZXh0IiwiYXBwbHkiLCJjaGlsZENvbnRleHRDbGFzcyIsImV4Y2x1ZGVDdXN0b21Ub0pzb24iLCJfZXhjbHVkZSIsIl9jb252ZXJ0RGF0YSIsIl9leGNsdWRlRGF0YSIsIl90b0pzb24iLCJfZXhjbHVkZUpzb24iLCJqc29uIiwicmVmIiwicmVmMSIsInRvSlNPTiIsIl9nZXRFbnVtZXJhdG9yIiwiX3RvSnNvbk5hbWVkIiwiYmluZCIsIl9nZXRFbnVtZXJhdG9yQXJyYXkiLCJfdGhpcyIsImNiIiwiZWxlbWVudCIsImkiLCJpZWxlbWVudCIsImxlbiIsImxlbmd0aCIsIl9nZXRKc29uSW5kZXgiLCJfZ2V0RW51bWVyYXRvck9iamVjdCIsInZhbCIsIl9nZXRKc29uS2V5IiwiX2dldEVudW1lcmF0b3JWYWx1ZSIsIkFycmF5IiwiaXNBcnJheSIsImNoaWxkQ29udGV4dCIsIl9jcmVhdGVDaGlsZENvbnRleHQiLCJhZGp1c3RDb250ZXh0Iiwib3ZlcnJpZGVzIiwic3RpY2t5IiwidmFsdWUiLCJhZGp1c3RDaGlsZENvbnRleHRzIiwic3VwZXJDbGFzcyIsIl9DbGFzcyIsImFyZ3VtZW50cyIsIl9zdXBlciIsIm5hbWUiLCJjbHMiLCJjdXJyZW50IiwiX2NhbGxTdXBlciIsImFyZ3MiLCJkYXRhSW5kZXgiLCJkYXRhUGF0aCIsIm5vZGUiLCJwYXRoIiwidW5zaGlmdCIsImpzb25QYXRoIiwicGF0aE1hcCIsImpvaW4iLCJXaXRoUGF0aE1hcCIsIm9iaiIsInBhdGhUcmVlIiwiaWQiLCJjaGlsZHJlbiIsIldpdGhQYXRoVHJlZSIsImRhdGFNYXAiLCJjb252ZXJ0ZWREYXRhIiwiV2l0aERhdGFNYXAiLCJkYXRhVHJlZSIsIldpdGhEYXRhVHJlZSJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FBQSxrQkFBQUMsU0FBQUEsT0FBQUMsSUNFSUQsVUFBV0QsR0FDaUIsZ0JBQVpHLFNBQ2hCQyxPQUFPRCxRQUFVSCxJREhyQkQsRUFBQU0sT0FBQUwsS0NPRU0sS0RORixXQ09BLEdBQUlDLEdETEpDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVDTUVDLEtETEZDLGVDTUVDLEVETEYsU0FBQUMsRUFBQUMsR0FBQSxRQUFBQyxLQUFBWixLQUFBYSxZQUFBSCxFQUFBLElBQUEsR0FBQUksS0FBQUgsR0FBQUosRUFBQVEsS0FBQUosRUFBQUcsS0FBQUosRUFBQUksR0FBQUgsRUFBQUcsR0FBQSxPQUFBRixHQUFBSSxVQUFBTCxFQUFBSyxVQUFBTixFQUFBTSxVQUFBLEdBQUFKLEdBQUFGLEVBQUFPLFVBQUFOLEVBQUFLLFVBQUFOLEdDTUVRLEtETEZBLEtDaVdBLE9BMVZBakIsR0RaQSxXQVFBLFFBQUFBLEdBQUFrQixFQUFBQyxHQVRBLE1DZUlwQixNQUFLcUIsS0FBT0YsRURmaEJuQixlQUFBQyxRQ2lCcUIsTUFBWG1CLElBQ0ZwQixLQUFLc0IsUURQYkYsRUFBQUUsUUNRUXRCLEtBQUt1QixRQUFVSCxFQUFRRyxRQUN2QnZCLEtBQUt3QixjRE5iSixFQUFBSSxnQkNTYSxHQUFLdkIsR0FBT0QsS0FBS3FCLEtBQU1ELEdBQVVLLFFBd001QyxNQXBNQXhCLEdBQU9lLFVB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Q3ZDekQsS0FBTUEsRURsRmRpRSxjQUFBL0IsRUFBQWxDLEtDb0ZRWSxLQUFNakMsS0FBS2lDLEtBQUtWLEtEOUR4QmdDLEdBQ0FyRCxHQ3FFR0QsR0FFSEEsRUFBT3NGLFlBQWNyRixFQUVyQkMsRUFBcUIsU0FBVTJELEdBRzdCLFFEcEVGM0QsR0FBQWtCLEVBQUFELEdBRUFqQixFQUFBYyxVQUFBSixZQUFBRSxLQUFBZixLQUFBcUIsRUFBQUQsR0NvRUlwQixLRG5FSndGLFlDeUZFLE1BMUJBL0UsR0FBT04sRUFBb0IyRCxHQU8zQjNELEVEbkVGYSxVQUFBVSxrQkFIQXZCLEVDd0VFQSxFQUFtQmEsVUFBVXNCLGFBQWUsU0FBU2pCLEVBQU1DLEVBQVNDLEdBQ2xFLEdEbEVKZ0MsRUMrRUksT0FaQUEsR0RsRUpwRCxFQUFBYyxVQUFBcUIsYUFBQXZCLEtBQUFmLEtBQUFxQixFQURBQyxFQUFBQyxHQVJBLFNBQUF2QixLQUFBaUMsS0FBQVYsS0M2RU12QixLQUFLd0YsU0FBU2pDLEVBQWFoQyxVRGxFakMyRCxHQUFBM0IsRUFBQWpDLFFBZEFELEtBQUFBLEVDbUZRaUUsY0FBZS9CLEVBQWFsQyxLQUM1QlksS0FBTWpDLEtBQUtpQyxLQUFLVixJRDVGeEJqQixFQUFBaUQsRUFBQWlDLFlDK0ZReEYsS0FBS3dGLFNBQVNqQyxFQUFhaEMsU0FBUzRELFNBQVc1QixFQUFhaUMsV0FHekRqQyxHQUdGcEQsR0FFTkYsR0FFSEEsRUFBT3dGLGFBQWV0RixFQUVmRiIsImZpbGUiOiJ0by1qc29uLnVtZC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBUb0pzb25cclxuICBjb25zdHJ1Y3RvcjogKEBkYXRhLCBvcHRpb25zKSAtPlxyXG4gICAgaWYgQCBpbnN0YW5jZW9mIFRvSnNvblxyXG4gICAgICAjIENhbGxlZCBhcyBjb25zdHJ1Y3RvclxyXG4gICAgICBpZiBvcHRpb25zP1xyXG4gICAgICAgIEBkYXRhS2V5ID0gb3B0aW9ucy5kYXRhS2V5XHJcbiAgICAgICAgQGpzb25LZXkgPSBvcHRpb25zLmpzb25LZXlcclxuICAgICAgICBAcGFyZW50Q29udGV4dCA9IG9wdGlvbnMucGFyZW50Q29udGV4dFxyXG4gICAgZWxzZVxyXG4gICAgICAjIENhbGxlZCBhcyBmdW5jdGlvblxyXG4gICAgICByZXR1cm4gKG5ldyBUb0pzb24oQGRhdGEsIG9wdGlvbnMpKS5hcHBseSgpXHJcblxyXG4gIGNoaWxkQ29udGV4dENsYXNzOiBAXHJcblxyXG4gICMgQ29udmVydHMgQGRhdGEgaW50byBqc29uIHdoaWxzdCBhcHBseWluZyBmaWx0ZXJzIGFuZCBjb252ZXJzaW9uc1xyXG4gIGFwcGx5OiAoZXhjbHVkZUN1c3RvbVRvSnNvbikgLT5cclxuICAgICMgZXhjbHVkZSBiZWZvcmUgZG9pbmcgYW55dGhpbmc/XHJcbiAgICBpZiBAX2V4Y2x1ZGUoKVxyXG4gICAgICByZXR1cm4gdW5kZWZpbmVkXHJcblxyXG4gICAgIyBjb252ZXJ0IHRoZSBpbmNvbWluZyBkYXRhIChjb250ZXh0LmRhdGEpXHJcbiAgICBAX2NvbnZlcnREYXRhKClcclxuXHJcbiAgICAjIGV4Y2x1ZGUgYmFzZWQgb24gdGhlIGNvbnZlcnRlZCBkYXRhXHJcbiAgICBpZiBAX2V4Y2x1ZGVEYXRhKClcclxuICAgICAgcmV0dXJuIHVuZGVmaW5lZFxyXG5cclxuICAgICMgY29udmVydCB0aGUgaW5jb21pbmcgZGF0YSAoY29udGV4dC5kYXRhKSBpbnRvIG91dGdvaW5nIGRhdGEgKGNvbnRleHQuanNvbilcclxuICAgIEBfdG9Kc29uKGV4Y2x1ZGVDdXN0b21Ub0pzb24pXHJcblxyXG4gICAgIyBleGNsdWRlIGJhc2VkIG9uIG91dGdvaW5nIGRhdGE/XHJcbiAgICBpZiBAX2V4Y2x1ZGVKc29uKClcclxuICAgICAgcmV0dXJuIHVuZGVmaW5lZFxyXG5cclxuICAgICMgcmV0dXJuIHRoZSBvdXRnb2luZyBkYXRhIChjb250ZXh0Lmpzb24pXHJcbiAgICByZXR1cm4gQGpzb25cclxuXHJcbiAgIyBDb252ZXJ0cyBAZGF0YSBpbnRvIGpzb25cclxuICBfdG9Kc29uOiAoZXhjbHVkZUN1c3RvbVRvSnNvbikgLT5cclxuICAgIGlmIG5vdCBleGNsdWRlQ3VzdG9tVG9Kc29uIGFuZCBAZGF0YT8udG9Kc29uPyBhbmQgdHlwZW9mIEBkYXRhLnRvSnNvbiA9PSAnZnVuY3Rpb24nXHJcbiAgICAgIEBqc29uID0gQGRhdGEudG9Kc29uKEApXHJcbiAgICBlbHNlIGlmIG5vdCBleGNsdWRlQ3VzdG9tVG9Kc29uIGFuZCBAZGF0YT8udG9KU09OPyBhbmQgdHlwZW9mIEBkYXRhLnRvSlNPTiA9PSAnZnVuY3Rpb24nXHJcbiAgICAgIEBqc29uID0gQGRhdGEudG9KU09OKClcclxuICAgIGVsc2VcclxuICAgICAgQGpzb24gPSBAX2dldEVudW1lcmF0b3IoKShAX3RvSnNvbk5hbWVkLmJpbmQoQCkpXHJcbiAgICByZXR1cm5cclxuXHJcbiAgIyBSZXR1cm5zIGFuIGVudW1lcmF0b3Igd2hpY2ggaXRlcmF0ZXMgb3ZlciBAZGF0YSBhcyBhbiBhcnJheSwgcmV0dXJuaW5nIHRoZSByZXN1bHRpbmcganNvblxyXG4gIF9nZXRFbnVtZXJhdG9yQXJyYXk6ICgpIC0+XHJcbiAgICByZXR1cm4gKGNiKSA9PlxyXG4gICAgICBAanNvbiA9IFtdXHJcbiAgICAgIGZvciBlbGVtZW50LCBpZWxlbWVudCBpbiBAZGF0YVxyXG4gICAgICAgIGNiKGVsZW1lbnQsIGllbGVtZW50LCBAX2dldEpzb25JbmRleChpZWxlbWVudCkpXHJcbiAgICAgIHJldHVybiBAanNvblxyXG5cclxuICAjIFJldHVybnMgYW4gZW51bWVyYXRvciB3aGljaCBpdGVyYXRlcyBvdmVyIEBkYXRhIGFzIGFuIG9iamVjdCwgcmV0dXJuaW5nIHRoZSByZXN1bHRpbmcganNvblxyXG4gIF9nZXRFbnVtZXJhdG9yT2JqZWN0OiAoKSAtPlxyXG4gICAgcmV0dXJuIChjYikgPT5cclxuICAgICAgQGpzb24gPSB7fVxyXG4gICAgICBmb3Igb3duIGtleSwgdmFsIG9mIEBkYXRhXHJcbiAgICAgICAgY2IodmFsLCBrZXksIEBfZ2V0SnNvbktleShrZXkpKVxyXG4gICAgICByZXR1cm4gQGpzb25cclxuXHJcbiAgIyBSZXR1cm5zIGFuIGVudW1lcmF0b3Igd2hpY2ggc2ltcGx5IHJldHVybnMgQGRhdGFcclxuICBfZ2V0RW51bWVyYXRvclZhbHVlOiAoKSAtPlxyXG4gICAgcmV0dXJuICgpID0+XHJcbiAgICAgIEBqc29uID0gQGRhdGFcclxuICAgICAgcmV0dXJuIEBqc29uXHJcblxyXG4gICMgUmV0dXJucyBhbiBlbnVtZXJhdG9yIHdoaWNoIGVudW1lcmF0ZXMgb3ZlciBkYXRhLCByZXR1cm5pbmcgdGhlIHJlc3VsdGluZyBqc29uXHJcbiAgX2dldEVudW1lcmF0b3I6ICgpIC0+XHJcbiAgICBpZiBBcnJheS5pc0FycmF5KEBkYXRhKVxyXG4gICAgICByZXR1cm4gQF9nZXRFbnVtZXJhdG9yQXJyYXkoKVxyXG4gICAgZWxzZSBpZiB0eXBlb2YgQGRhdGEgPT0gJ29iamVjdCcgYW5kIEBkYXRhICE9IG51bGxcclxuICAgICAgcmV0dXJuIEBfZ2V0RW51bWVyYXRvck9iamVjdCgpXHJcbiAgICBlbHNlXHJcbiAgICAgIHJldHVybiBAX2dldEVudW1lcmF0b3JWYWx1ZSgpXHJcblxyXG4gICMjXHJcbiAgIyBTdGFuZGFyZCBjYWxsYmFjayB1c2VkIGluIGVudW1lcmF0b3JzLlxyXG4gICMgQHBhcmFtIGRhdGEgLSBkYXRhIHRvIGJlIGNvbnZlcnRlZFxyXG4gICMgQHBhcmFtIGRhdGFLZXkge3N0cmluZ3xpbnR9IC0ga2V5L2luZGV4IGludG8gdGhlIHBhcmVudCBzb3VyY2UgZGF0YSBhcyBkZXRlcm1pbmVkIGJ5IHRoZSBlbnVtZXJhdG9yXHJcbiAgIyBAcGFyYW0ganNvbktleSB7c3RyaW5nfGludH0gLSBrZXkvaW5kZXggaW50byB0aGUganNvbiB0YXJnZXQgZGF0YSBhcyBkZXRlcm1pbmVkIGJ5IHRoZSBlbnVtZXJhdG9yXHJcbiAgIyBAcmV0dXJuIHt0b0pzb259IGNoaWxkIGNvbnRleHRcclxuICBfdG9Kc29uTmFtZWQ6IChkYXRhLCBkYXRhS2V5LCBqc29uS2V5KSAtPlxyXG4gICAgY2hpbGRDb250ZXh0ID0gQF9jcmVhdGVDaGlsZENvbnRleHQoZGF0YSwgZGF0YUtleSwganNvbktleSlcclxuXHJcbiAgICBqc29uID0gY2hpbGRDb250ZXh0LmFwcGx5KClcclxuXHJcbiAgICBpZiBqc29uICE9IHVuZGVmaW5lZFxyXG4gICAgICBAanNvbltqc29uS2V5XSA9IGpzb25cclxuXHJcbiAgICByZXR1cm4gY2hpbGRDb250ZXh0XHJcblxyXG4gICMgcmV0dXJucyBhIG5ldyBjb250ZXh0IGZvciB1c2Ugd2l0aCBjaGlsZCBkYXRhXHJcbiAgIyBhcmd1bWVudHMgYXJlIHRoZSBzYW1lIGFzIHRob3NlIGdpdmVuIHRvIEBfdG9Kc29uTmFtZWRcclxuICBfY3JlYXRlQ2hpbGRDb250ZXh0OiAoZGF0YSwgZGF0YUtleSwganNvbktleSkgLT5cclxuICAgIHJldHVybiBuZXcgQGNoaWxkQ29udGV4dENsYXNzKFxyXG4gICAgICBkYXRhLFxyXG4gICAgICB7XHJcbiAgICAgICAgZGF0YUtleTogZGF0YUtleVxyXG4gICAgICAgIGpzb25LZXk6IGpzb25LZXlcclxuICAgICAgICBwYXJlbnRDb250ZXh0OiBAXHJcbiAgICAgIH1cclxuICAgIClcclxuXHJcbiAgIyBVdGlsaXR5IGZ1bmN0aW9uIGZvciBvdmVycmlkaW5nIGNoaWxkIGNvbnRleHQgbWV0aG9kc1xyXG4gICMgVXNlZnVsIGZvciBhcHBseWluZyB2YXJpb3VzIGZpbHRlcnMgZXRjIGZvciB0aGUgY3VycmVudCBjb250ZXh0XHJcbiAgYWRqdXN0Q29udGV4dDogKG92ZXJyaWRlcywgc3RpY2t5KSAtPlxyXG4gICAgZm9yIG93biBrZXksIHZhbHVlIG9mIG92ZXJyaWRlc1xyXG4gICAgICBAW2tleV0gPSB2YWx1ZVxyXG5cclxuICAgIGlmIHN0aWNreVxyXG4gICAgICBAYWRqdXN0Q2hpbGRDb250ZXh0cyhvdmVycmlkZXMsIHN0aWNreSlcclxuICAgIHJldHVybiBAXHJcblxyXG4gICMgVXRpbGl0eSBmdW5jdGlvbiBmb3Igb3ZlcnJpZGluZyBjaGlsZCBjb250ZXh0IG1ldGhvZHNcclxuICAjIFVzZWZ1bCBmb3IgYXBwbHlpbmcgdmFyaW91cyBmaWx0ZXJzIGV0YyBmb3Igb25seSB0aGUgaW1tZWRpYXRlIGNoaWxkIGNsYXNzZXNcclxuICAjIEBwYXJhbSB7Qm9vbGVhbn0gc3RpY2t5IC0gSWYgVHJ1ZSwgYWxsIGZ1dHVyZSBnZW5lcmF0aW9ucyB3aWxsIGJlIG92ZXJyaWRkZW5cclxuICBhZGp1c3RDaGlsZENvbnRleHRzOiAob3ZlcnJpZGVzLCBzdGlja3kpIC0+XHJcbiAgICBAY2hpbGRDb250ZXh0Q2xhc3MgPSBjbGFzcyBleHRlbmRzIEBjaGlsZENvbnRleHRDbGFzc1xyXG4gICAgZm9yIG93biBrZXksIHZhbHVlIG9mIG92ZXJyaWRlc1xyXG4gICAgICBAY2hpbGRDb250ZXh0Q2xhc3MucHJvdG90eXBlW2tleV0gPSB2YWx1ZVxyXG4gICAgaWYgc3RpY2t5XHJcbiAgICAgIEBjaGlsZENvbnRleHRDbGFzcy5wcm90b3R5cGUuY2hpbGRDb250ZXh0Q2xhc3MgPSBAY2hpbGRDb250ZXh0Q2xhc3NcclxuICAgIHJldHVybiBAXHJcblxyXG4gICMgdXRpbGl0eSBmdW5jdGlvbiBmb3IgY2hhaW5pbmcgc3VwZXIgbWV0aG9kc1xyXG4gIF9zdXBlcjogKG5hbWUpIC0+XHJcbiAgICBjdXJyZW50ID0gQFtuYW1lXVxyXG4gICAgY2xzID0gQGNvbnN0cnVjdG9yXHJcbiAgICB3aGlsZSBjbHM/IGFuZCBjbHMucHJvdG90eXBlW25hbWVdID09IGN1cnJlbnRcclxuICAgICAgY2xzID0gY2xzLl9fc3VwZXJfXy5jb25zdHJ1Y3RvclxyXG4gICAgcmV0dXJuIGNscy5wcm90b3R5cGVbbmFtZV1cclxuXHJcbiAgX2NhbGxTdXBlcjogKG5hbWUsIGFyZ3MuLi4pIC0+XHJcbiAgICBAX3N1cGVyKG5hbWUpLmFwcGx5KEAsIGFyZ3MpXHJcblxyXG4gICMgUmV0dXJucyB0aGUga2V5IHRvIHVzZSBmb3IgdGhlIGpzb24gb3V0cHV0XHJcbiAgX2dldEpzb25LZXk6IChkYXRhS2V5KSAtPlxyXG4gICAgZGF0YUtleVxyXG5cclxuICAjIFJldHVybnMgdGhlIGtleSB0byB1c2UgZm9yIHRoZSBqc29uIG91dHB1dFxyXG4gIF9nZXRKc29uSW5kZXg6IChkYXRhSW5kZXgpIC0+XHJcbiAgICBAanNvbi5sZW5ndGhcclxuXHJcbiAgIyBleGNsdWRlIGJlZm9yZSBkb2luZyBhbnl0aGluZz9cclxuICBfZXhjbHVkZTogKCkgLT5cclxuICAgIGZhbHNlXHJcblxyXG4gICMgY29udmVydCB0aGUgaW5jb21pbmcgZGF0YVxyXG4gIF9jb252ZXJ0RGF0YTogKCkgLT5cclxuICAgIHJldHVyblxyXG5cclxuICAjIGV4Y2x1ZGUgYmFzZWQgb24gdGhlIGNvbnZlcnRlZCBkYXRhXHJcbiAgX2V4Y2x1ZGVEYXRhOiAoKSAtPlxyXG4gICAgZmFsc2VcclxuXHJcbiAgIyBleGNsdWRlIGJhc2VkIG9uIG91dGdvaW5nIGRhdGE/XHJcbiAgX2V4Y2x1ZGVKc29uOiAoKSAtPlxyXG4gICAgZmFsc2VcclxuXHJcbiAgIyByZXR1cm4gZGF0YSBwYXRoIGZvciB0aGlzIGNvbnRleHRcclxuICBkYXRhUGF0aDogKCkgLT5cclxuICAgIHBhdGggPSBbXVxyXG4gICAgbm9kZSA9IEBcclxuICAgIHdoaWxlIG5vZGU/XHJcbiAgICAgIGlmIG5vZGUuZGF0YUtleT9cclxuICAgICAgICBwYXRoLnVuc2hpZnQobm9kZS5kYXRhS2V5KVxyXG4gICAgICBub2RlID0gbm9kZS5wYXJlbnRDb250ZXh0XHJcbiAgICByZXR1cm4gcGF0aFxyXG5cclxuICAjIHJldHVybiBqc29uIHBhdGggZm9yIHRoaXMgY29udGV4dFxyXG4gIGpzb25QYXRoOiAoKSAtPlxyXG4gICAgcGF0aCA9IFtdXHJcbiAgICBub2RlID0gQFxyXG4gICAgd2hpbGUgbm9kZT9cclxuICAgICAgaWYgbm9kZS5qc29uS2V5P1xyXG4gICAgICAgIHBhdGgudW5zaGlmdChub2RlLmpzb25LZXkpXHJcbiAgICAgIG5vZGUgPSBub2RlLnBhcmVudENvbnRleHRcclxuICAgIHJldHVybiBwYXRoXHJcblxyXG5jbGFzcyBUb0pzb25XaXRoUGF0aE1hcCBleHRlbmRzIFRvSnNvblxyXG4gIGNvbnN0cnVjdG9yOiAoZGF0YSwgb3B0aW9ucykgLT5cclxuICAgIHN1cGVyKGRhdGEsIG9wdGlvbnMpXHJcblxyXG4gICAgQHBhdGhNYXAgPSBAcGFyZW50Q29udGV4dD8ucGF0aE1hcCA/IHt9XHJcblxyXG4gIGNoaWxkQ29udGV4dENsYXNzOiBAXHJcblxyXG4gIF90b0pzb25OYW1lZDogKGRhdGEsIGRhdGFLZXksIGpzb25LZXkpIC0+XHJcbiAgICBjaGlsZENvbnRleHQgPSBzdXBlcihkYXRhLCBkYXRhS2V5LCBqc29uS2V5KVxyXG5cclxuICAgIGlmIEBqc29uW2pzb25LZXldICE9IHVuZGVmaW5lZFxyXG4gICAgICBAcGF0aE1hcFtjaGlsZENvbnRleHQuanNvblBhdGgoKS5qb2luKCcvJyldID0gY2hpbGRDb250ZXh0LmRhdGFQYXRoKCkuam9pbignLycpXHJcblxyXG4gICAgcmV0dXJuIGNoaWxkQ29udGV4dFxyXG5cclxuVG9Kc29uLldpdGhQYXRoTWFwID0gVG9Kc29uV2l0aFBhdGhNYXBcclxuXHJcbmlzRW1wdHkgPSAob2JqKSAtPlxyXG4gIGZvciBvd24ga2V5IG9mIG9ialxyXG4gICAgcmV0dXJuIGZhbHNlXHJcbiAgcmV0dXJuIHRydWVcclxuXHJcbmNsYXNzIFRvSnNvbldpdGhQYXRoVHJlZSBleHRlbmRzIFRvSnNvblxyXG4gIGNvbnN0cnVjdG9yOiAoZGF0YSwgb3B0aW9ucykgLT5cclxuICAgIHN1cGVyKGRhdGEsIG9wdGlvbnMpXHJcblxyXG4gICAgQHBhdGhUcmVlID0ge31cclxuXHJcbiAgY2hpbGRDb250ZXh0Q2xhc3M6IEBcclxuXHJcbiAgX3RvSnNvbk5hbWVkOiAoZGF0YSwgZGF0YUtleSwganNvbktleSkgLT5cclxuICAgIGNoaWxkQ29udGV4dCA9IHN1cGVyKGRhdGEsIGRhdGFLZXksIGpzb25LZXkpXHJcblxyXG4gICAgaWYgQGpzb25banNvbktleV0gIT0gdW5kZWZpbmVkXHJcbiAgICAgIGlmIG5vdCBpc0VtcHR5KGNoaWxkQ29udGV4dC5wYXRoVHJlZSlcclxuICAgICAgICBAcGF0aFRyZWVbY2hpbGRDb250ZXh0Lmpzb25LZXldID0ge1xyXG4gICAgICAgICAgaWQ6IGNoaWxkQ29udGV4dC5kYXRhS2V5LFxyXG4gICAgICAgICAgY2hpbGRyZW46IGNoaWxkQ29udGV4dC5wYXRoVHJlZVxyXG4gICAgICAgIH1cclxuICAgICAgZWxzZVxyXG4gICAgICAgIEBwYXRoVHJlZVtjaGlsZENvbnRleHQuanNvbktleV0gPSB7XHJcbiAgICAgICAgICBpZDogY2hpbGRDb250ZXh0LmRhdGFLZXlcclxuICAgICAgICB9XHJcblxyXG4gICAgcmV0dXJuXHJcblxyXG5Ub0pzb24uV2l0aFBhdGhUcmVlID0gVG9Kc29uV2l0aFBhdGhUcmVlXHJcblxyXG5jbGFzcyBUb0pzb25XaXRoRGF0YU1hcCBleHRlbmRzIFRvSnNvblxyXG4gIGNvbnN0cnVjdG9yOiAoZGF0YSwgb3B0aW9ucykgLT5cclxuICAgIHN1cGVyKGRhdGEsIG9wdGlvbnMpXHJcblxyXG4gICAgQGRhdGFNYXAgPSBAcGFyZW50Q29udGV4dD8uZGF0YU1hcCA/IHt9XHJcblxyXG4gIGNoaWxkQ29udGV4dENsYXNzOiBAXHJcblxyXG4gIF90b0pzb25OYW1lZDogKGRhdGEsIGRhdGFLZXksIGpzb25LZXkpIC0+XHJcbiAgICBjaGlsZENvbnRleHQgPSBzdXBlcihkYXRhLCBkYXRhS2V5LCBqc29uS2V5KVxyXG5cclxuICAgIGlmIEBqc29uW2pzb25LZXldICE9IHVuZGVmaW5lZFxyXG4gICAgICBAZGF0YU1hcFtjaGlsZENvbnRleHQuanNvblBhdGgoKS5qb2luKCcvJyldID0ge1xyXG4gICAgICAgIGRhdGFQYXRoOiBjaGlsZENvbnRleHQuZGF0YVBhdGgoKS5qb2luKCcvJylcclxuICAgICAgICBkYXRhOiBkYXRhXHJcbiAgICAgICAgY29udmVydGVkRGF0YTogY2hpbGRDb250ZXh0LmRhdGFcclxuICAgICAgICBqc29uOiBAanNvbltqc29uS2V5XVxyXG4gICAgICB9XHJcblxyXG4gICAgcmV0dXJuIGNoaWxkQ29udGV4dFxyXG5cclxuVG9Kc29uLldpdGhEYXRhTWFwID0gVG9Kc29uV2l0aERhdGFNYXBcclxuY2xhc3MgVG9Kc29uV2l0aERhdGFUcmVlIGV4dGVuZHMgVG9Kc29uXHJcbiAgY29uc3RydWN0b3I6IChkYXRhLCBvcHRpb25zKSAtPlxyXG4gICAgc3VwZXIoZGF0YSwgb3B0aW9ucylcclxuXHJcbiAgICBAZGF0YVRyZWUgPSB7fVxyXG5cclxuICBjaGlsZENvbnRleHRDbGFzczogQFxyXG5cclxuICBfdG9Kc29uTmFtZWQ6IChkYXRhLCBkYXRhS2V5LCBqc29uS2V5KSAtPlxyXG4gICAgY2hpbGRDb250ZXh0ID0gc3VwZXIoZGF0YSwgZGF0YUtleSwganNvbktleSlcclxuXHJcbiAgICBpZiBAanNvbltqc29uS2V5XSAhPSB1bmRlZmluZWRcclxuICAgICAgQGRhdGFUcmVlW2NoaWxkQ29udGV4dC5qc29uS2V5XSA9IHtcclxuICAgICAgICBpZDogY2hpbGRDb250ZXh0LmRhdGFLZXlcclxuICAgICAgICBkYXRhOiBkYXRhXHJcbiAgICAgICAgY29udmVydGVkRGF0YTogY2hpbGRDb250ZXh0LmRhdGFcclxuICAgICAgICBqc29uOiBAanNvbltqc29uS2V5XVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiBub3QgaXNFbXB0eShjaGlsZENvbnRleHQuZGF0YVRyZWUpXHJcbiAgICAgICAgQGRhdGFUcmVlW2NoaWxkQ29udGV4dC5qc29uS2V5XS5jaGlsZHJlbiA9IGNoaWxkQ29udGV4dC5kYXRhVHJlZVxyXG5cclxuICAgIHJldHVybiBjaGlsZENvbnRleHRcclxuXHJcblRvSnNvbi5XaXRoRGF0YVRyZWUgPSBUb0pzb25XaXRoRGF0YVRyZWVcclxuIixudWxsXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=